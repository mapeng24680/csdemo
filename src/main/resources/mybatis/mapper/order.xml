<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.csdn.demo.sys.dao.OrderDao">
    <insert id="insert" parameterType="com.csdn.demo.sys.entity.Order">
        insert into order (sender_id,user_id,order_num,order_msg,commission,update_time,create_time)
        values (#{senderId},#{userId},#{orderNum},#{commission},now(),now())
    </insert>
    <update id="update" parameterType="com.csdn.demo.sys.entity.EnterprisePublished">
        update order set update_time=now()
        <if test="userId!=null and userId!=''">
            and user_id=#{userId}
        </if>
		<if test="commission!=null and commission!=''">
			and commission=#{commission}
		</if>
        <if test="status!=null and status!=''">
            and status=#{status}
        </if>
        where id=#{id}
    </update>
    <select id="selectList" resultType="com.csdn.demo.sys.entity.Order">
     SELECT
		c.sender_id AS senderId,
		c.user_id AS userId,
		d.user_name AS senderName,
		c.user_name AS cuserName,
		c.order_num AS orderNum,
		c.order_msg AS orderMsg,
		c.commission,
		c.STATUS,
		c.create_time AS createTime,
		c.update_time AS updateTime
	FROM
	(
		SELECT
			a.*, b.user_name
		FROM
			`order` a
		LEFT JOIN `user` b ON a.user_id = b.id
		WHERE
			a.sender_id = #{senderId}
	) c,
	`user` d
	WHERE
	c.sender_id = d.id
    </select>

	<select id="selectUserOrder" resultType="com.csdn.demo.sys.entity.Order">
		SELECT
		c.sender_id AS senderId,
		c.user_id AS userId,
		d.user_name AS senderName,
		c.user_name AS cuserName,
		c.order_num AS orderNum,
		c.order_msg AS orderMsg,
		c.commission,
		c.STATUS,
		c.create_time AS createTime,
		c.update_time AS updateTime
	FROM
	(
		SELECT
			a.*, b.user_name
		FROM
			`order` a
		LEFT JOIN `user` b ON a.sender_id = b.id
		WHERE
			a.user_id = #{userId}
	) c,
	`user` d
	WHERE
	c.user_id = d.id
	</select>

	<select id="selectPublishOrder" resultType="com.csdn.demo.sys.entity.Order">
		SELECT
			a.sender_id AS senderId,
			a.user_id AS userId,
			b.user_name AS senderName,
			a.order_num AS orderNum,
			a.order_msg AS orderMsg,
			a.commission,
			a.STATUS,
			a.create_time AS createTime,
			a.update_time AS updateTime
		FROM
			`order` a
		LEFT JOIN `user` b ON a.sender_id = b.id
		WHERE
			a.status= 0
	</select>
</mapper>